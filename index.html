<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>weather</title>
    <style>
      body {
        background: black;
        margin: 0;
      }
    </style>
  </head>

  <body>
    <canvas id="weather" width="3400" height="1600">Loadingâ€¦</canvas>
    <script>
      {
        const canvas = document.getElementById("weather");
        const ctx = canvas.getContext("2d");

        const load = async () => {
          const response = await fetch("/images/manifest.txt");
          const manifest = await response.text();
          const filenames = manifest.trim().split("\n");
          const bitmaps = Array(filenames.length);

          filenames.forEach(async (filename, i) => {
            const response = await fetch(`/images/${filename}`);
            const blob = await response.blob();
            bitmaps[i] = await window.createImageBitmap(blob);
          });

          console.log(bitmaps);

          let index = -1;
          const render = () => {
            index = index === filenames.length - 1 ? 0 : index + 1;
            if (bitmaps[index] !== undefined) {
              ctx.drawImage(bitmaps[index], 0, 0);
            }
          };

          render();

          window.setInterval(render, 200);
        };

        load();
      }
    </script>
  </body>
</html>
